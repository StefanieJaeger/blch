import { createPublicClient, createWalletClient, custom } from 'viem'
import { sepolia } from 'viem/chains'
import abi from './voting-abi.json'
import { encodeBytes32String } from 'ethers';

export const votingClient = createPublicClient({ 
  chain: sepolia, 
  transport: custom(window.ethereum), 
}) ;

// start tryout deploying hardcoded contract with viem
export async function getWalletClient() {
  if (!window.ethereum) throw new Error("MetaMask not found");
  const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
  return createWalletClient({
    chain: sepolia,
    transport: custom(window.ethereum),
    account: accounts[0] as `0x${string}`,
  });
};

const bytecode = '0x608060405234801561000f575f5ffd5b506040516110793803806110798339818101604052810190610031919061054b565b61004283838361004a60201b60201c565b505050610600565b335f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550826006819055505f6003819055505f60045f6101000a81548160ff0219169083151502179055505f5f90505b825181101561013657600560405180604001604052808584815181106100de576100dd6105d3565b5b602002602001015181526020015f815250908060018154018082558091505060019003905f5260205f2090600202015f909190919091505f820151815f015560208201518160010155505080806001019150506100b5565b5080516002819055505f5f90505b81518110156102975760405180606001604052805f151581526020017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81526020016001151581525060015f8484815181106101a3576101a26105d3565b5b602002602001015173ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f820151815f015f6101000a81548160ff021916908315150217905550602082015181600101556040820151816002015f6101000a81548160ff0219169083151502179055509050508181815181106102405761023f6105d3565b5b602002602001015173ffffffffffffffffffffffffffffffffffffffff167f29bd95a6e95c4d9719ffeaa905fd16f2601a302bbde771ffa35896905fc847b560405160405180910390a28080600101915050610144565b50505050565b5f604051905090565b5f5ffd5b5f5ffd5b5f819050919050565b6102c0816102ae565b81146102ca575f5ffd5b50565b5f815190506102db816102b7565b92915050565b5f5ffd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b61032b826102e5565b810181811067ffffffffffffffff8211171561034a576103496102f5565b5b80604052505050565b5f61035c61029d565b90506103688282610322565b919050565b5f67ffffffffffffffff821115610387576103866102f5565b5b602082029050602081019050919050565b5f5ffd5b5f6103ae6103a98461036d565b610353565b905080838252602082019050602084028301858111156103d1576103d0610398565b5b835b818110156103fa57806103e688826102cd565b8452602084019350506020810190506103d3565b5050509392505050565b5f82601f830112610418576104176102e1565b5b815161042884826020860161039c565b91505092915050565b5f67ffffffffffffffff82111561044b5761044a6102f5565b5b602082029050602081019050919050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6104858261045c565b9050919050565b6104958161047b565b811461049f575f5ffd5b50565b5f815190506104b08161048c565b92915050565b5f6104c86104c384610431565b610353565b905080838252602082019050602084028301858111156104eb576104ea610398565b5b835b81811015610514578061050088826104a2565b8452602084019350506020810190506104ed565b5050509392505050565b5f82601f830112610532576105316102e1565b5b81516105428482602086016104b6565b91505092915050565b5f5f5f60608486031215610562576105616102a6565b5b5f61056f868287016102cd565b935050602084015167ffffffffffffffff8111156105905761058f6102aa565b5b61059c86828701610404565b925050604084015167ffffffffffffffff8111156105bd576105bc6102aa565b5b6105c98682870161051e565b9150509250925092565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b610a6c8061060d5f395ff3fe608060405234801561000f575f5ffd5b506004361061009c575f3560e01c8063bf63a57711610064578063bf63a57714610147578063dd60c89814610165578063e2ba53f014610183578063f0232d0a146101a1578063f851a440146101bf5761009c565b80630121b93f146100a057806309e69ede146100bc578063409e2205146100ee5780635c53b6321461011f5780639fde4ef814610129575b5f5ffd5b6100ba60048036038101906100b5919061063a565b6101dd565b005b6100d660048036038101906100d191906106bf565b61039b565b6040516100e59392919061071c565b60405180910390f35b6101086004803603810190610103919061063a565b6103d9565b604051610116929190610778565b60405180910390f35b610127610408565b005b6101316104a0565b60405161013e919061079f565b60405180910390f35b61014f61051e565b60405161015c91906107b8565b60405180910390f35b61016d610524565b60405161017a919061079f565b60405180910390f35b61018b61052a565b60405161019891906107b8565b60405180910390f35b6101a961055a565b6040516101b6919061079f565b60405180910390f35b6101c7610560565b6040516101d491906107e0565b60405180910390f35b5f60015f3373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20905060045f9054906101000a900460ff161561026c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161026390610853565b60405180910390fd5b806002015f9054906101000a900460ff166102bc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102b3906108bb565b60405180910390fd5b805f015f9054906101000a900460ff161561030c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161030390610923565b60405180910390fd5b6001815f015f6101000a81548160ff02191690831515021790555081816001018190555060016005838154811061034657610345610941565b5b905f5260205f2090600202016001015f828254610363919061099b565b92505081905550600160035f82825461037c919061099b565b925050819055506003546002540361039757610396610584565b5b5050565b6001602052805f5260405f205f91509050805f015f9054906101000a900460ff1690806001015490806002015f9054906101000a900460ff16905083565b600581815481106103e8575f80fd5b905f5260205f2090600202015f91509050805f0154908060010154905082565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610496576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161048d90610a18565b60405180910390fd5b61049e610584565b565b5f5f5f90505f5f90505b6005805490508110156105195781600582815481106104cc576104cb610941565b5b905f5260205f20906002020160010154111561050c57600581815481106104f6576104f5610941565b5b905f5260205f2090600202016001015491508092505b80806001019150506104aa565b505090565b60065481565b60025481565b5f60056105356104a0565b8154811061054657610545610941565b5b905f5260205f2090600202015f0154905090565b60035481565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600160045f6101000a81548160ff0219169083151502179055505f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fff820582797f9899ed808db75ac74c10466cc3d7073fe31a3a2dc108600f1ddc60405160405180910390a2565b5f5ffd5b5f819050919050565b61061981610607565b8114610623575f5ffd5b50565b5f8135905061063481610610565b92915050565b5f6020828403121561064f5761064e610603565b5b5f61065c84828501610626565b91505092915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61068e82610665565b9050919050565b61069e81610684565b81146106a8575f5ffd5b50565b5f813590506106b981610695565b92915050565b5f602082840312156106d4576106d3610603565b5b5f6106e1848285016106ab565b91505092915050565b5f8115159050919050565b6106fe816106ea565b82525050565b5f819050919050565b61071681610704565b82525050565b5f60608201905061072f5f8301866106f5565b61073c602083018561070d565b61074960408301846106f5565b949350505050565b5f819050919050565b61076381610751565b82525050565b61077281610607565b82525050565b5f60408201905061078b5f83018561075a565b6107986020830184610769565b9392505050565b5f6020820190506107b25f830184610769565b92915050565b5f6020820190506107cb5f83018461075a565b92915050565b6107da81610684565b82525050565b5f6020820190506107f35f8301846107d1565b92915050565b5f82825260208201905092915050565b7f566f74696e672068617320616c726561647920656e64656400000000000000005f82015250565b5f61083d6018836107f9565b915061084882610809565b602082019050919050565b5f6020820190508181035f83015261086a81610831565b9050919050565b7f486173206e6f20726967687420746f20766f74650000000000000000000000005f82015250565b5f6108a56014836107f9565b91506108b082610871565b602082019050919050565b5f6020820190508181035f8301526108d281610899565b9050919050565b7f416c726561647920766f7465642e0000000000000000000000000000000000005f82015250565b5f61090d600e836107f9565b9150610918826108d9565b602082019050919050565b5f6020820190508181035f83015261093a81610901565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6109a582610607565b91506109b083610607565b92508282019050808211156109c8576109c761096e565b5b92915050565b7f4f6e6c792061646d696e2063616e20636c6f73652074686520766f74650000005f82015250565b5f610a02601d836107f9565b9150610a0d826109ce565b602082019050919050565b5f6020820190508181035f830152610a2f816109f6565b905091905056fea2646970667358221220981c404b28c25cd5910320f1ebb61897414a03ba38a41c8dc1c21a0b7b9f9b2c64736f6c634300081e0033';
// tryout hardcoded constructor args
const topicName = encodeBytes32String('Test-voting topic??');
// const topicName = '0x5b4b0f9e7a1d1c8e8b3a2c7f5e6d4a3b1e0f9d8c7b6a5f4e3d2c1b0a9f8e7d6c';
const optionNames = ["0x6a61000000000000000000000000000000000000000000000000000000000000","0x7965730000000000000000000000000000000000000000000000000000000000","0x6162736f6c7574656c7900000000000000000000000000000000000000000000"];
const participantAddresses = ["0x147Acb91Cb3d8E1c1ef0cE3BfB8a056Ac6C54d99"];

// TODO: TS: tell me why do we get error bc it expects 0 args???
export async function deployVotingContract() {
    const walletClient = await getWalletClient();
    const hash = await walletClient.deployContract({
        abi,
        args: [topicName, optionNames, participantAddresses],
        bytecode,
    });
    console.log('transaction hash:', hash);
}

// end tryout deploying hardcoded contract with viem